#ifndef __ICM_H
#define __ICM_H

#include "zf_common_typedef.h"
#include "zf_device_icm20602.h"

/* ICM专用全局变量声明 */
extern uint8 icm_gyro_ration;
extern uint8 icm_acc_ration;
extern float icm_filtering_angle;
extern float icm_angle_roll_temp;
extern float icm_angle_yaw_temp;
extern float icm_yaw;
extern int16_t icm_gx_error, icm_gy_error, icm_gz_error;
extern float icm_call_cycle;
extern int16_t icm_gx, icm_gy, icm_gz;
extern int16_t icm_ax, icm_ay, icm_az;
extern float icm_machine_mid;

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     初始化ICM20602姿态解算
// 参数说明     void
// 返回参数     void
// 使用示例     icm_attitude_init();
// 备注信息     
//-------------------------------------------------------------------------------------------------------------------
void icm_attitude_init(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     校准ICM20602传感器
// 参数说明     void
// 返回参数     void
// 使用示例     icm_calibrate();
// 备注信息     需要保持传感器静止进行校准
//-------------------------------------------------------------------------------------------------------------------
void icm_calibrate(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     ICM20602一阶互补滤波姿态解算
// 参数说明     void
// 返回参数     void
// 使用示例     icm_first_order_complementary_filtering();
// 备注信息     
//-------------------------------------------------------------------------------------------------------------------
void icm_first_order_complementary_filtering(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     获取ICM姿态角度
// 参数说明     roll        滚转角指针（输出）
// 参数说明     pitch       俯仰角指针（输出）
// 参数说明     yaw         偏航角指针（输出）
// 返回参数     void
// 使用示例     float roll_angle, pitch_angle, yaw_angle;
//              icm_get_attitude_angles(&roll_angle, &pitch_angle, &yaw_angle);
// 备注信息     
//-------------------------------------------------------------------------------------------------------------------
void icm_get_attitude_angles(float *roll, float *pitch, float *yaw_angle);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     设置ICM中值角度
// 参数说明     mid_angle    中值角度
// 返回参数     void
// 使用示例     icm_set_machine_mid(90.0f);
// 备注信息     
//-------------------------------------------------------------------------------------------------------------------
void icm_set_machine_mid(float mid_angle);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     设置ICM采样周期
// 参数说明     cycle        采样周期（秒）
// 返回参数     void
// 使用示例     icm_set_call_cycle(0.001f);  // 设置1kHz采样
// 备注信息     
//-------------------------------------------------------------------------------------------------------------------
void icm_set_call_cycle(float cycle);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     获取当前ICM滤波后的角度
// 参数说明     void
// 返回参数     float        滤波后的角度
// 使用示例     float current_angle = icm_get_filtering_angle();
// 备注信息     
//-------------------------------------------------------------------------------------------------------------------
float icm_get_filtering_angle(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     获取当前ICM偏航角
// 参数说明     void
// 返回参数     float        偏航角
// 使用示例     float current_yaw = icm_get_yaw();
// 备注信息     
//-------------------------------------------------------------------------------------------------------------------
float icm_get_yaw(void);

#endif
